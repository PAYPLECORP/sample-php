<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
<title>Insert title here</title>
<style>
.loader {
  display: none;
	position: fixed;
	left: 0px;
	top: 0px;
	width: 100%;
	height: 100%;
	z-index: 9999;
	background: url('/img/spin.gif') 50% 40% no-repeat rgb(249,249,249);
  opacity: 0.8;
}

input {
    width: 300px;
    height: 20px;
    border: 1px solid gray
}
</style>
<script src="/js/jquery-3.2.1.min.js"></script>
<script>
$(document).ready( function () {
	
	var AuthFormReqAction = function () {

		var formData = new FormData($('#AuthForm')[0]);

		$.ajax({
			type : 'POST',
			cache : false,
			processData : false,
			contentType : false,
// 			async : false,
			url : '/cPayPayple/sample/payple_AuthRegSend.php',
			dataType : 'json',
			data : formData,
			success : function (data) {
// 			    console.log(data);
			    
				alert(data.PCD_PAY_MSG);

				if (data.PCD_PAY_RST == 'success') {

					$('#AuthFormSubmit').css('display','none');

					$('#PCD_AUTH_NUM').text(data.PCD_AUTH_NUM);
					$('#AuthConfirm').css('display', '');

					if (data.PCD_PAY_BANKACCTYPE == 'corporate') $('#CorpBankAuth').css('display', '');

					$('#AuthConfirmAction').on('click', function (event) {

						event.preventDefault();						
						
						$(".loader").show();
						
						setTimeout(function () {
							AuthRegConfirmAction(data);
						}, 500);
						
					});

				}
    			
			},
			error : function (jqxhr, status, error) {
// 				console.log(jqxhr);
				
// 			    alert(jqxhr.statusText + ",  " + status + ",   " + error);
// 			    alert(jqxhr.status);
// 			    alert(jqxhr.responseText);
    			
			},
			complete : function () {
				$('.loader').hide();
			}
		});

		
	};


	var AuthRegConfirmAction = function (data) {
		
		var formData = new FormData();

		$.each(data, function (key, value) {
			formData.append(key, value);
		});

		if (data.PCD_PAY_BANKACCTYPE == 'corporate') {

			var PCD_BANK_AUTH_CODE_VAL = $('#PCD_BANK_AUTH_CODE').val().replace(/\D/g, '');

			if (PCD_BANK_AUTH_CODE_VAL == '' || PCD_BANK_AUTH_CODE_VAL.length != 4) {
				
				alert('법인계좌 인증코드를 입력하세요.!!');

				$('.loader').hide();

				return false;
			}
			
			formData.append('PCD_BANK_AUTH_CODE', PCD_BANK_AUTH_CODE_VAL);
			
		}
		
		$.ajax({
			type : 'POST',
			cache : false,
			processData : false,
			contentType : false,
// 			async : false,
			url : '/cPayPayple/sample/payple_AuthRegConfirmSend.php',
			dataType : 'json',
			data : formData,
			success : function (data) {
 			    console.log(data);
			    
				alert(data.PCD_PAY_MSG);

				if (data.PCD_PAY_RST == 'success') {

					var $_table = $("<table></table>");
					var table_data = "";
					
					$.each(data, function (key, value) {
						table_data += '<tr><td>'+key+'</td><td>'+value+'</td><tr>';
					});

					$_table.append(table_data);
					
					$_table.appendTo('#authreq_result');

					$('#authreq_result').css('display', '');

				}
    			
			},
			error : function (jqxhr, status, error) {
 				console.log(jqxhr);
			
 			    alert(jqxhr.statusText + ",  " + status + ",   " + error);
 			    alert(jqxhr.status);
 			    alert(jqxhr.responseText);
    			
			},
			complete : function () {
				$('.loader').hide();
			}
		});
		
	};


	$('#PCD_PAY_BANKACCTYPE').on('change', function (event) {

		event.preventDefault();

		if ($(this).val() == 'corporate') {

			$('#corporate_input').css('display', '');
			
		} else {

			$('#corporate_input').css('display', 'none');
			
		}
		
	});	

	$('#AuthFormSubmit').on('click', function (event) {

		event.preventDefault();

		$(".loader").show();
		
		setTimeout(function () {
			AuthFormReqAction();
		}, 500);
		
	});

});
</script>
</head>
<body>
    <div id="loader" class="loader"></div>
	<form id="AuthForm" name="AuthForm">
	  <div>
	    <label for="PCD_PAYER_NO">회원 고유번호</label>
	    <input type="number" name="PCD_PAYER_NO" id="PCD_PAYER_NO" value="">
	  </div>
	  <div>
	  	<label for="PCD_PAY_BANKACCTYPE">계좌구분</label>
	  	<select id="PCD_PAY_BANKACCTYPE" name="PCD_PAY_BANKACCTYPE">
	  	  <option value="personal">개인</option>
	  	  <option value="corporate">법인, 개인사업자</option>
	  	</select>
	  </div>
	  <div>
	  	<label for="PCD_PAYER_NAME">이름</label>
	    <input type="text" name="PCD_PAYER_NAME" id="PCD_PAYER_NAME" value="">
	  </div>
	  <div>
	  	<label for="PCD_PAYER_BIRTH">생년월일</label>
	    <input type="number" name="PCD_PAYER_BIRTH" id="PCD_PAYER_BIRTH" value="" maxlength='8'>
	  </div>
	  <div>
	  	<label for="PCD_PAYER_GENDER">성별</label>
	    <select id="PCD_PAYER_GENDER" name="PCD_PAYER_GENDER">
	    	<option value="1">남</option>
	    	<option value="2">여</option>
	    </select>
	  </div>
	  <div>
	  	<label for="PCD_PAYER_HPCOM">통신사</label>
	  	<select id="PCD_PAYER_HPCOM" name="PCD_PAYER_HPCOM">
	  		<option value="01">SKT</option>
            <option value="02">KT</option>
            <option value="03">LGU</option>
            <option value="04">SKT 알뜰폰</option>
            <option value="05">KT 알뜰폰</option>
            <option value="06">LGU 알뜰폰</option>
	  	</select>
	  </div>
	  <div>
	    <label for="PCD_PAYER_HP">휴대폰번호</label>
	    <input type="number" name="PCD_PAYER_HP" id="PCD_PAYER_HP" value="">
	  </div>
	  <div>
	    <label for="PCD_PAYER_EMAIL">Email</label>
	    <input type="text" name="PCD_PAYER_EMAIL" id="PCD_PAYER_EMAIL" value="">
	  </div>
	  <div id = 'corporate_input' style='display: none'>
		  <div>
		    <label for="PCD_PAYER_CORPNUM">사업자번호</label>
		    <input type="number" name="PCD_PAYER_CORPNUM" id="PCD_PAYER_CORPNUM" value="">
		  </div>
	  </div>
	  <div>
	    <label for="PCD_PAY_BANK">은행</label>
	    <select id="PCD_PAY_BANK" name="PCD_PAY_BANK">
			<option value="004">국민은행</option>
			<option value="011">농협은행</option>
			<option value="088">신한은행</option>
			<option value="020">우리은행</option>
			<option value="003">기업은행</option>
			<option value="002">산업은행</option>
			<option value="081">KEB하나은행</option>
			<option value="071">우체국</option>
			<option value="045">새마을금고</option>
			<option value="048">신협중앙회</option>
			<option value="031">대구은행</option>
			<option value="034">광주은행</option>
			<option value="039">경남은행</option>
			<option value="007">수협중앙회</option>
			<option value="032">부산은행</option>
	    </select>
	  </div>
	  <div>
	    <label for="PCD_PAY_BANKNUM">계좌번호</label>
	    <input type="number" name="PCD_PAY_BANKNUM" id="PCD_PAY_BANKNUM" value="">
	  </div>
	  <div>
	  	<label for="is_reguler">정기결제</label>
	  	<select id="is_reguler" name="is_reguler">
	  		<option value="N">N</option>
	  		<option value="Y">Y</option>
	  	</select>
	  </div>
	</form>
    <button id="AuthFormSubmit">인증등록 요청</button>
    <br>
    <div id="CorpBankAuth" style="display: none; width: 400px; border: 1px solid black;">
    	<form id="CorpBankAuthForm" name="CorpBankAuthForm">
    		<label for="PCD_BANK_AUTH_CODE">법인계좌 인증코드</label>
    		<input type="number" id="PCD_BANK_AUTH_CODE" name="PCD_BANK_AUTH_CODE" value="" maxlength=4 required placeholder="계좌인증코드(숫자)를 입력하세요.">
    	</form>    
    </div>
    <br>
    <div id="AuthConfirm" style="display: none; width: 400px; border: 1px solid black; font-size: 30pt;">
        <label for="PCD_AUTH_NUM">인증번호 : </label>
    	<span id="PCD_AUTH_NUM" style="font-size: 20px; font-weight: bold;"></span>
    	<br>
    	<center><button id="AuthConfirmAction" style="width: 100%; height: 80px; font-size: 20pt;">전화받기(ARS)</button></center>
    </div>
    <br>
    <hr>
    <div id="authreq_result" style="display:none; border:1px solid black">
    </div>
</body>
</html>